/* 
What are the most optimal (high paying + high demand) skills to learn 
*/

WITH demand_skills AS (
    SELECT
        skills_dim.skill_id,
        skills_dim.skills,
        COUNT(job_postings_fact.job_id) AS total_demand
    FROM 
        job_postings_fact
    INNER JOIN 
        skills_job_dim ON job_postings_fact.job_id = skills_job_dim.job_id
    INNER JOIN 
        skills_dim ON skills_job_dim.skill_id = skills_dim.skill_id
    WHERE 
        job_title_short like '%Data%Analyst%' AND salary_year_avg IS NOT NULL
    GROUP BY 
        skills_dim.skill_id
),
TOP_SKILLS AS (
    SELECT
        skills_job_dim.skill_id,
    ROUND( AVG(salary_year_avg), 0) AS avg_salary
    FROM 
        job_postings_fact
    INNER JOIN 
        skills_job_dim ON job_postings_fact.job_id = skills_job_dim.job_id
    INNER JOIN 
        skills_dim ON skills_job_dim.skill_id = skills_dim.skill_id
    WHERE 
        job_title_short like '%Data%Analyst%' AND salary_year_avg IS NOT NULL
    GROUP BY 
        skills_job_dim.skill_id
)
SELECT
    demand_skills.skill_id,
    demand_skills.skills,
    total_demand,
    avg_Salary
FROM 
    demand_skills
INNER JOIN TOP_SKILLS on demand_skills.skill_id = TOP_SKILLS.skill_id
ORDER BY total_demand DESC,
        avg_salary DESC
        LIMIT 25